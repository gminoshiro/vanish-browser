# シナリオテスト実施ガイド

**作成日**: 2025-10-22
**対象**: VanishBrowser iOS App

---

## 📋 テスト概要

実際のユーザーの使用シナリオに基づいたテストを実施し、アプリの動作を確認します。

---

## 🧪 テストシナリオ一覧

### シナリオ1: 画像10個ダウンロード

**目的**: 画像ダウンロード機能の基本動作確認

**手順**:
1. アプリを起動
2. 画像サイトにアクセス（推奨: https://unsplash.com/）
3. 画像を長押しして「画像をダウンロード」をタップ × 10回
4. ダウンロードボタンをタップしてダウンロードリストを開く

**期待結果**:
- ✅ 10個の画像がダウンロードリストに表示される
- ✅ 各画像にサムネイルが表示される
- ✅ ファイル名が正しく表示される
- ✅ ファイルサイズが表示される
- ✅ タップすると画像が全画面表示される

**確認項目**:
- [ ] ダウンロード進捗が表示された
- [ ] ダウンロード完了通知が表示された
- [ ] 10個すべて正常にダウンロードされた
- [ ] サムネイルが正しく表示される
- [ ] 画像をタップして内容確認できる

---

### シナリオ2: 動画10個ダウンロード

**目的**: 動画ダウンロード機能（HLS→MP4変換含む）の動作確認

**手順**:
1. 動画サイトにアクセス（推奨: YouTube、サンプル動画サイト）
2. 動画が検出されるまで待つ（三点リーダメニューに「動画をダウンロード」が表示）
3. 三点リーダ → 「動画をダウンロード」をタップ
4. ダウンロードダイアログでファイル名・品質・フォルダを選択
5. 「ダウンロード」をタップ
6. 上記を10回繰り返す

**期待結果**:
- ✅ 10個の動画がダウンロードリストに表示される
- ✅ すべて.mp4形式で保存されている
- ✅ 動画をタップするとカスタムプレーヤーで再生される
- ✅ 再生コントロール（再生/一時停止、シーク、音量）が動作する

**確認項目**:
- [ ] 動画検出が正常に動作した
- [ ] HLS→MP4変換が正常に完了した（HLS動画の場合）
- [ ] 10個すべて正常にダウンロードされた
- [ ] カスタムプレーヤーで再生できる
- [ ] 再生コントロールが正常に動作する
- [ ] 動画の内容が正しい（破損していない）

---

### シナリオ3: 画像10個 + 動画10個 + 内容確認

**目的**: 混合ダウンロードとストレージ管理の動作確認

**手順**:
1. シナリオ1を実施（画像10個）
2. シナリオ2を実施（動画10個）
3. ダウンロードリストを開く
4. 各ファイルをタップして内容確認
5. 三点リーダ → 設定 → ストレージセクションを確認

**期待結果**:
- ✅ 合計20個のファイルがリストに表示される
- ✅ 画像と動画が混在して表示される
- ✅ ストレージ情報が正しく表示される
  - ダウンロード済みファイル: 20件
  - 使用容量: XX MB
  - デバイス空き容量: XX GB

**確認項目**:
- [ ] 総ファイル数が20個
- [ ] 画像10個、動画10個が正しく表示
- [ ] すべてのファイルが開ける
- [ ] ストレージ使用量が正確
- [ ] デバイス空き容量が表示される
- [ ] スクロールが正常に動作する

---

### シナリオ4: ダウンロード + 自動削除

**目的**: 自動削除機能の動作確認

**手順**:
1. 画像5個 + 動画5個をダウンロード（合計10個）
2. ダウンロードリストで10個確認
3. 三点リーダ → 設定 → 手動削除セクション
4. 「すべてのデータを削除」をタップ
5. 確認ダイアログで「削除」を選択
6. ダウンロードリストに戻る

**期待結果**:
- ✅ 削除前: 10個のファイルが表示
- ✅ 削除確認ダイアログが表示される
- ✅ 削除後: ダウンロードリストが空になる
- ✅ ストレージ使用量が0件、0バイトになる

**確認項目**:
- [ ] 削除前のファイル数: 10個
- [ ] 確認ダイアログが表示された
- [ ] 削除後のファイル数: 0個
- [ ] ファイルが完全に削除された（ファイルシステムからも削除）
- [ ] ストレージ情報が更新された

---

### シナリオ5: 重複ファイル名のダウンロード

**目的**: 重複ファイル名の連番処理の動作確認

**手順**:
1. 同じ画像サイトから同じ画像を3回ダウンロード
   - 1回目ダウンロード → ファイル名確認
   - 2回目ダウンロード → ファイル名確認
   - 3回目ダウンロード → ファイル名確認
2. ダウンロードリストで3個のファイル確認

**期待結果**:
- ✅ 3個のファイルが保存される
- ✅ ファイル名が以下のようになる:
  - `image.jpg`
  - `image (1).jpg`
  - `image (2).jpg`
- ✅ どれも正しく開ける

**確認項目**:
- [ ] 3個すべてダウンロードされた
- [ ] ファイル名が連番になっている
- [ ] 既存ファイルが上書きされていない
- [ ] すべてのファイルが開ける

---

### シナリオ6: フォルダ分け

**目的**: フォルダ機能の動作確認

**手順**:
1. 画像をダウンロードし、フォルダ「仕事」を選択
2. 別の画像をダウンロードし、フォルダ「プライベート」を選択
3. 別の画像をダウンロードし、フォルダ「その他」を選択
4. ダウンロードリストでフォルダごとに表示されることを確認

**期待結果**:
- ✅ 3つのフォルダが作成される
- ✅ 各フォルダに1個ずつファイルがある
- ✅ フォルダごとに折りたたみ/展開できる

**確認項目**:
- [ ] フォルダ「仕事」に1個
- [ ] フォルダ「プライベート」に1個
- [ ] フォルダ「その他」に1個
- [ ] フォルダの折りたたみ/展開が動作する
- [ ] フォルダ内のファイルをタップして開ける

---

### シナリオ7: 大量ダウンロード（50個） + ストレージ計算

**目的**: 大量ファイルのパフォーマンスとストレージ計算の動作確認

**手順**:
1. 画像を50個ダウンロード（時間がかかるため、小さい画像推奨）
2. ダウンロードリストをスクロールして動作確認
3. 設定 → ストレージ情報を確認

**期待結果**:
- ✅ 50個すべてダウンロードされる
- ✅ リストのスクロールがスムーズ
- ✅ ストレージ使用量が正しく計算される
- ✅ アプリがクラッシュしない

**確認項目**:
- [ ] 50個すべてダウンロード完了
- [ ] スクロールがスムーズ（ラグなし）
- [ ] サムネイル表示が正常
- [ ] ストレージ使用量が正確（ファイル数50件、総サイズXX MB）
- [ ] アプリが安定動作している

---

## 🎯 推奨テストサイト

### 画像ダウンロード
- **Unsplash**: https://unsplash.com/
  - 高品質な無料画像
  - 様々なサイズの画像あり

- **Pexels**: https://www.pexels.com/
  - フリー画像・動画
  - テスト用に最適

### 動画ダウンロード
- **Sample Videos**: https://sample-videos.com/
  - 各種フォーマットのサンプル動画
  - MP4、HLS形式あり

- **YouTube**: https://www.youtube.com/
  - 動画検出機能のテスト
  - HLS→MP4変換のテスト

---

## 📝 テスト実施記録テンプレート

```
# シナリオテスト実施記録

実施日時: 2025-10-22
実施者:
デバイス: iPhone 16
iOSバージョン: 18.1

## シナリオ1: 画像10個ダウンロード
- [ ] 実施完了
- 結果: ✅ 成功 / ❌ 失敗
- 備考:

## シナリオ2: 動画10個ダウンロード
- [ ] 実施完了
- 結果: ✅ 成功 / ❌ 失敗
- 備考:

## シナリオ3: 画像10個 + 動画10個 + 内容確認
- [ ] 実施完了
- 結果: ✅ 成功 / ❌ 失敗
- 備考:

## シナリオ4: ダウンロード + 自動削除
- [ ] 実施完了
- 結果: ✅ 成功 / ❌ 失敗
- 備考:

## シナリオ5: 重複ファイル名
- [ ] 実施完了
- 結果: ✅ 成功 / ❌ 失敗
- 備考:

## シナリオ6: フォルダ分け
- [ ] 実施完了
- 結果: ✅ 成功 / ❌ 失敗
- 備考:

## シナリオ7: 大量ダウンロード（50個）
- [ ] 実施完了
- 結果: ✅ 成功 / ❌ 失敗
- 備考:

## 総合評価
- 成功: X / 7
- 失敗: X / 7
- 総合判定: ✅ 合格 / ❌ 不合格

## 発見した問題
1.
2.
3.
```

---

## 🔧 トラブルシューティング

### ダウンロードが始まらない
- ネットワーク接続を確認
- 動画検出まで数秒待つ
- ページをリロードして再試行

### 動画が検出されない
- サイトによっては検出できない場合あり
- 別の動画サイトで試す
- 動画を一度再生してから試す

### アプリがクラッシュする
- アプリを再起動
- デバイスを再起動
- ストレージ容量を確認

### ファイルが開けない
- ファイルが破損している可能性
- 再ダウンロードを試す
- ファイル形式を確認

---

## 📊 自動確認スクリプト

シナリオテスト実施後、以下のスクリプトで状態確認できます：

```bash
bash test_scenarios.sh
```

**確認内容**:
- ダウンロードフォルダのファイル数
- 総ストレージ使用量
- ダウンロード済みファイル一覧

---

## ✅ テスト完了基準

すべてのシナリオで以下を満たすこと：

1. **機能性**: すべての機能が仕様通りに動作する
2. **安定性**: クラッシュやフリーズが発生しない
3. **パフォーマンス**: スムーズに動作する（ラグなし）
4. **データ整合性**: ファイルが破損せず、データが正確
5. **UI/UX**: 操作が直感的で、エラーメッセージが適切

---

## 📎 関連ドキュメント

- [CHECK_LIST.md](CHECK_LIST.md) - 機能別チェックリスト
- [CODE_VERIFICATION_REPORT.md](CODE_VERIFICATION_REPORT.md) - コード静的検証レポート
- [test_scenarios.sh](../test_scenarios.sh) - 自動確認スクリプト
- [ScenarioTests.swift](../VanishBrowser/VanishBrowserTests/ScenarioTests.swift) - ユニットテスト
