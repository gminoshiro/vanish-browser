# Vanish Browser - タスク管理

最終更新: 2025-10-15

---

## 🎯 現在の優先度

| 優先度 | 件数 | 説明 |
|--------|------|------|
| 🔴 P0 Critical | 2件 | 即時対応必須（アプリの主要機能が動作しない） |
| 🟠 P1 High | 1件 | 次のリリースまでに対応 |
| 🟡 P2 Medium | 0件 | 対応予定 |
| 🟢 P3 Low | 1件 | 余裕があれば対応 |

---

## 🔴 P0: Critical - 即時対応必須

### BUG-001: DL後の動画・画像が開けない
**ステータス**: ⏳ 調査必要
**担当**: 未割り当て
**作成日**: 2025-10-13

**現象**:
- ダウンロード済みの動画・画像をタップしても開けない
- プレーヤーが起動しない（白い画面のまま）

**原因**:
- 相対パス変換の実装は完了したが、実際の動作確認でまだ開けない
- マイグレーション処理が正しく動作していない可能性

**小タスク**:
- [ ] 実機でDL済みファイル一覧を確認
- [ ] ファイルパスのログ出力を確認
- [ ] FileViewerViewでのファイル読み込み処理を確認
- [ ] getAbsolutePath()が正しく動作しているか確認
- [ ] ファイルの実在確認（FileManager.fileExists）

**対応優先度**: 🔴 最優先（アプリの主要機能）

---

### BUG-002: DL前の動画再生で標準プレーヤーに途中で切り替わる
**ステータス**: ⏳ 調査必要
**担当**: 未割り当て
**作成日**: 2025-10-13

**現象**:
- ダウンロード前に動画を再生すると、カスタムプレーヤーで開始するが途中で標準プレーヤーに切り替わる
- 標準プレーヤーになると閉じることができなくなる

**原因**:
- VideoInterceptorの0.1秒ポーリング監視を実装したが、まだ完全には防げていない
- 標準プレーヤーが表示された後に検出している可能性

**小タスク**:
- [ ] 実機でVideoInterceptorのログを確認
- [ ] ポーリング間隔を短くする（0.05秒）
- [ ] WKWebViewのconfigurationを再確認
- [ ] allowsInlineMediaPlayback設定を確認
- [ ] mediaTypesRequiringUserActionForPlayback設定を確認

**対応優先度**: 🔴 最優先（UX重大問題）

---

## 🟠 P1: High - 次のリリースまでに対応

### BUG-003: DL前の動画再生でDLボタンが消えたり表示されたりする
**ステータス**: ⏳ 調査必要
**担当**: 未割り当て
**作成日**: 2025-10-13

**現象**:
- ダウンロード前の動画再生中、ダウンロードボタンが表示されたり消えたりバグっている
- UIの状態管理が不安定

**小タスク**:
- [ ] CustomVideoPlayerViewのshowDownloadButtonの値変更をログ出力
- [ ] isDownloaded判定のロジックを確認
- [ ] ファイル存在確認の処理を確認
- [ ] @Stateの更新タイミングを確認

**対応優先度**: 🟠 高（UX問題）

---

## 🟢 P3: Low - 余裕があれば対応

### BUG-007: 動画再生開始直後のダウンロード問題
**ステータス**: 📝 記録済み（チケット作成済み）
**担当**: 未割り当て
**作成日**: 2025-10-15

**現象**:
- 動画を再生してすぐにDLボタンを押すとダウンロードができない
- 少し待ってから押すとダウンロードできる

**回避策**: 数秒待ってからDLボタンを押す

**対応優先度**: 🟢 低（回避策あり）

**詳細**: `docs/02-improvements/BUG-007-video-download-timing.md` 参照

---

## ✅ 完了済み（2025-10-15セッション）

### BUG-004: ブックマークフォルダ選択
- ✅ BookmarkFolderSelectionView作成
- ✅ フォルダ選択ダイアログ実装
- ✅ 新規フォルダ作成機能
- ✅ 「未分類」デフォルトフォルダ削除
- ✅ フォルダ未選択時はホーム（フォルダなし）に保存

### BUG-005: ブックマークEditボタン
- ✅ `.onDelete`修飾子の配置修正
- ✅ swipe-to-delete機能が正常動作

### BUG-006: 空フォルダの自動削除
- ✅ `deleteEmptyFolders()`関数実装
- ✅ ブックマーク削除時に自動実行
- ✅ 空のブックマークを除外して判定

### フォルダ管理改善
- ✅ DL時のフォルダ選択に「ホーム」追加
- ✅ フォルダ未選択時はDownloadsディレクトリ直下に保存
- ✅ 「ホーム」セクション表示を削除（直接ファイル表示）
- ✅ DownloadManager修正（空フォルダを作らない）
- ✅ ブックマークも同様の仕様に統一

---

## 📊 実装完了機能（参考）

### コア機能
- ✅ Webブラウジング（戻る/進む/リロード/検索）
- ✅ 複数タブ管理
- ✅ ブックマーク管理
- ✅ 閲覧履歴
- ✅ プライベートモード

### ダウンロード
- ✅ ファイルダウンロード（進捗表示/フォルダ管理）
- ✅ カスタムビデオプレーヤー
- ✅ ファイルビューア
- ✅ ファイル名変更/移動/削除
- ✅ フォルダ階層管理

### セキュリティ
- ✅ 生体認証（Face ID / Touch ID）
- ✅ アプリロック
- ✅ 自動削除機能

---

## 🚀 リリース前チェックリスト

### 必須対応
- [ ] BUG-001: DL後のファイルが開けない → 修正必要
- [ ] BUG-002: 標準プレーヤーに切り替わる → 修正必要
- [ ] 実機での動作確認
- [ ] クラッシュテスト

### 推奨対応
- [ ] BUG-003: DLボタンの表示不安定 → 修正推奨
- [ ] App Store用スクリーンショット作成
- [ ] プライバシーポリシー最終確認

### 任意対応
- [ ] BUG-007: 動画再生直後のDL問題 → 後回しOK

---

## 📝 ステータス凡例

| アイコン | 意味 |
|---------|------|
| 🔴 P0 | Critical - 即時対応必須 |
| 🟠 P1 | High - 次のリリースまでに対応 |
| 🟡 P2 | Medium - 対応予定 |
| 🟢 P3 | Low - 余裕があれば対応 |
| 🔍 | 調査中 |
| 📝 | 未着手 |
| 🚧 | 作業中 |
| ⏳ | ユーザー確認待ち/調査必要 |
| ✅ | 完了 |
| ❌ | 却下/不要 |

---

## 🎮 次のアクション

1. **BUG-001（DL後のファイルが開けない）を優先対応**
   - まず実機で現象を確認
   - ログを確認してパス問題を特定
   - 修正後にテスト

2. **BUG-002（標準プレーヤーに切り替わる）を対応**
   - VideoInterceptorの強化
   - テストサイトで動作確認

3. **実機での総合テスト**
   - 全機能の動作確認
   - クラッシュテスト

4. **gitにPUSHしてリリース準備**
